<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>客戶資料轉移系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 html2canvas 和 jsPDF 函式庫 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- 修正：為 Google Fonts 添加 crossorigin="anonymous" 屬性 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet" crossorigin="anonymous">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f5ff;
        }
        .card {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .card:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .btn-primary {
            background-color: #3b82f6;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }
        .btn-secondary {
            background-color: #6b7280;
            transition: all 0.3s ease;
        }
        .btn-secondary:hover {
            background-color: #4b5563;
        }
        .btn-success {
            background-color: #10b981;
            transition: all 0.3s ease;
        }
        .btn-success:hover {
            background-color: #059669;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* 列印樣式 */
        @media print {
            body * {
                visibility: hidden; /* 預設隱藏所有內容 */
            }
            #printArea, #printArea * {
                visibility: visible; /* 讓列印區域及其子元素可見 */
            }
            #printArea {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 20px;
                background-color: white;
                box-sizing: border-box; /* 確保 padding 不會導致寬度溢出 */
                font-size: 11pt; /* 調整整體字體大小 */
            }
            .no-print {
                display: none !important; /* 確保不列印的元素徹底隱藏 */
            }
            .print-border {
                border: 1px solid #000 !important;
            }
            .print-border-bottom {
                border-bottom: 1px solid #000 !important;
            }
            .print-page-break {
                page-break-after: always; /* 強制分頁 */
            }
            /* 調整表格在列印時的邊界和字體大小 */
            #printArea table {
                font-size: 10pt; /* 表格內字體可以小一點 */
                border-collapse: collapse; /* 確保邊框合併 */
            }
            #printArea td, #printArea th {
                padding: 5px 8px !important; /* 調整表格內邊距 */
                border: 1px solid #000 !important; /* 確保表格邊框顯示 */
            }
            #printArea h1, #printArea h2, #printArea h3 {
                color: #000 !important; /* 確保標題為黑色 */
            }
            #printArea .text-gray-600 {
                color: #333 !important; /* 調整灰色文字深淺 */
            }
            #printArea .bg-gray-50, #printArea .bg-gray-100 {
                background-color: #f0f0f0 !important; /* 淺灰色背景 */
            }
            #printArea ol {
                list-style-type: decimal !important;
                padding-left: 20px !important;
            }
            #printArea li {
                margin-bottom: 5px !important;
            }
        }
        
        /* 確保列印區域在非列印時隱藏 */
        #printArea {
            display: none;
        }
        /* 僅在需要時顯示，用於列印或生成PDF */
        #printArea.show-for-print {
            display: block;
        }
        
        /* 載入指示器 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            display: none; /* 預設隱藏 */
        }
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 表格樣式 */
        .print-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #000;
        }
        .print-table th, .print-table td {
            border: 1px solid #000;
            padding: 8px;
        }
        .print-table th {
            background-color: #f2f2f2;
        }
        
        /* 注意事項和回傳方式框架 */
        .notice-box {
            border: 1px solid #000;
            padding: 10px;
            margin-bottom: 20px;
        }
        
        /* 注意事項標題置中 */
        .notice-title {
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        /* 簽名欄位 */
        .signature-box {
            display: flex;
            width: 100%;
            margin-top: 20px;
        }
        .signature-cell {
            flex: 1;
            border: 1px solid #000;
            height: 120px;
            padding: 10px;
            text-align: center;
            display: flex; /* 使用 flexbox 讓內容垂直置中 */
            align-items: flex-end; /* 底部對齊 */
            justify-content: center; /* 水平置中 */
        }
        
        /* 注意事項列表左對齊 */
        .notice-list {
            text-align: left;
            width: 100%;
        }
    </style>
</head>
<body>
    <!-- 載入指示器 -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="bg-white p-6 rounded-lg shadow-lg text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p id="loadingText" class="text-lg font-medium text-gray-700">正在處理，請稍候...</p>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-center text-gray-800">客戶資料轉移系統</h1>
            <p class="text-center text-gray-600 mt-2">將A客戶的使用權限轉移給B客戶</p>
        </header>

        <div id="inputForm">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- A客戶資料卡 -->
                <div class="card bg-white rounded-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-800">A客戶資料 (轉出方)</h2>
                        <div class="flex items-center">
                            <span id="customerAStatus" class="mr-2 hidden text-green-600">✓ 已載入</span>
                            <button id="searchA" class="btn-primary text-white px-4 py-2 rounded-md">查詢客戶</button>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">客戶編號</label>
                        <input type="text" id="customerA_id" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="請輸入客戶編號">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">姓名</label>
                        <input type="text" id="customerA_name" class="w-full px-4 py-2 border rounded-md bg-gray-100" readonly>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-700 mb-2">生日</label>
                            <input type="text" id="customerA_birthday" class="w-full px-4 py-2 border rounded-md bg-gray-100" readonly>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">身分證號</label>
                            <input type="text" id="customerA_idNumber" class="w-full px-4 py-2 border rounded-md bg-gray-100" readonly>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">地址</label>
                        <input type="text" id="customerA_address" class="w-full px-4 py-2 border rounded-md bg-gray-100" readonly>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-700 mb-2">電話</label>
                            <input type="text" id="customerA_phone" class="w-full px-4 py-2 border rounded-md bg-gray-100" readonly>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">使用期限</label>
                            <input type="date" id="customerA_expiry" class="w-full px-4 py-2 border rounded-md bg-gray-100" readonly>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">剩餘天數</label>
                        <input type="text" id="customerA_daysLeft" class="w-full px-4 py-2 border rounded-md bg-gray-100" readonly>
                    </div>
                </div>

                <!-- B客戶資料卡 -->
                <div class="card bg-white rounded-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-800">B客戶資料 (接收方)</h2>
                        <div class="flex items-center">
                            <span id="customerBStatus" class="mr-2 hidden text-green-600">✓ 已載入</span>
                            <button id="searchB" class="btn-primary text-white px-4 py-2 rounded-md">查詢客戶</button>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">客戶編號</label>
                        <input type="text" id="customerB_id" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="請輸入客戶編號">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">姓名</label>
                        <input type="text" id="customerB_name" class="w-full px-4 py-2 border rounded-md bg-gray-100" readonly>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-700 mb-2">生日</label>
                            <input type="text" id="customerB_birthday" class="w-full px-4 py-2 border rounded-md bg-gray-100" readonly>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">身分證號</label>
                            <input type="text" id="customerB_idNumber" class="w-full px-4 py-2 border rounded-md bg-gray-100" readonly>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">地址</label>
                        <input type="text" id="customerB_address" class="w-full px-4 py-2 border rounded-md bg-gray-100" readonly>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-700 mb-2">電話</label>
                            <input type="text" id="customerB_phone" class="w-full px-4 py-2 border rounded-md bg-gray-100" readonly>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">目前使用期限</label>
                            <input type="date" id="customerB_currentExpiry" class="w-full px-4 py-2 border rounded-md bg-gray-100" readonly>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">轉移後到期日</label>
                        <input type="date" id="customerB_newExpiry" class="w-full px-4 py-2 border rounded-md bg-gray-100" readonly>
                    </div>
                </div>
            </div>

            <!-- 轉移設定區域 -->
            <div class="card bg-white rounded-lg p-6 mt-8">
                <h2 class="text-xl font-bold text-gray-800 mb-6">轉移設定</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-gray-700 mb-2">轉移日期</label>
                        <input type="date" id="transferDate" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 mb-2">轉移天數</label>
                        <input type="text" id="transferDays" class="w-full px-4 py-2 border rounded-md bg-gray-100" readonly>
                    </div>
                </div>
                
                <div class="mt-6">
                    <label class="block text-gray-700 mb-2">轉移備註</label>
                    <textarea id="transferNotes" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" placeholder="請輸入轉移原因或其他備註"></textarea>
                </div>
            </div>

            <!-- 操作按鈕 -->
            <div class="flex justify-center mt-8 space-x-4">
                <button id="calculateBtn" class="btn-primary text-white px-6 py-3 rounded-md font-medium">計算轉移資訊</button>
                <button id="transferBtn" class="btn-success text-white px-6 py-3 rounded-md font-medium">確認轉移</button>
                <button id="resetBtn" class="btn-secondary text-white px-6 py-3 rounded-md font-medium">重置表單</button>
            </div>
        </div>

        <!-- 轉移結果顯示區域 -->
        <div id="resultArea" class="mt-8 hidden fade-in">
            <div class="card bg-green-50 border-l-4 border-green-500 p-6 mb-8">
                <div class="flex items-center mb-4">
                    <svg class="w-6 h-6 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <h3 class="text-lg font-bold text-green-700">轉移成功</h3>
                </div>
                <p id="resultMessage" class="text-green-600 mb-4"></p>
                <div class="flex justify-end">
                    <button id="backToForm" class="text-blue-600 hover:text-blue-800 font-medium">返回表單</button>
                </div>
            </div>

            <!-- 轉移詳細資訊 -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- 轉讓戶資料 -->
                <div class="card bg-white rounded-lg p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                        <svg class="w-5 h-5 text-red-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                        轉讓戶資料
                    </h2>
                    
                    <div class="mb-4">
                        <label class="block text-gray-500 text-sm mb-1">客戶編號</label>
                        <p id="result_transferor_id" class="text-gray-800 font-medium"></p>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-500 text-sm mb-1">姓名</label>
                        <p id="result_transferor_name" class="text-gray-800 font-medium"></p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-500 text-sm mb-1">生日</label>
                            <p id="result_transferor_birthday" class="text-gray-800 font-medium"></p>
                        </div>
                        <div>
                            <label class="block text-gray-500 text-sm mb-1">身分證號</label>
                            <p id="result_transferor_idNumber" class="text-gray-800 font-medium"></p>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-500 text-sm mb-1">地址</label>
                        <p id="result_transferor_address" class="text-gray-800 font-medium"></p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-500 text-sm mb-1">電話</label>
                            <p id="result_transferor_phone" class="text-gray-800 font-medium"></p>
                        </div>
                        <div>
                            <label class="block text-gray-500 text-sm mb-1">原使用期限</label>
                            <p id="result_transferor_expiry" class="text-gray-800 font-medium"></p>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-500 text-sm mb-1">轉移時間</label>
                        <p id="result_transferPeriod" class="text-gray-800 font-medium"></p>
                    </div>
                </div>

                <!-- 承接者資料 -->
                <div class="card bg-white rounded-lg p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                        <svg class="w-5 h-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                        </svg>
                        承接者資料
                    </h2>
                    
                    <div class="mb-4">
                        <label class="block text-gray-500 text-sm mb-1">客戶編號</label>
                        <p id="result_recipient_id" class="text-gray-800 font-medium"></p>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-500 text-sm mb-1">姓名</label>
                        <p id="result_recipient_name" class="text-gray-800 font-medium"></p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-500 text-sm mb-1">生日</label>
                            <p id="result_recipient_birthday" class="text-gray-800 font-medium"></p>
                        </div>
                        <div>
                            <label class="block text-gray-500 text-sm mb-1">身分證號</label>
                            <p id="result_recipient_idNumber" class="text-gray-800 font-medium"></p>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-500 text-sm mb-1">地址</label>
                        <p id="result_recipient_address" class="text-gray-800 font-medium"></p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-500 text-sm mb-1">電話</label>
                            <p id="result_recipient_phone" class="text-gray-800 font-medium"></p>
                        </div>
                        <div>
                            <label class="block text-gray-500 text-sm mb-1">原使用期限</label>
                            <p id="result_recipient_oldExpiry" class="text-gray-800 font-medium"></p>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-500 text-sm mb-1">新使用期限</label>
                        <p id="result_recipient_newExpiry" class="text-gray-800 font-medium text-green-600"></p>
                    </div>
                </div>
            </div>

            <!-- 轉移詳情 -->
            <div class="card bg-white rounded-lg p-6 mt-8">
                <h2 class="text-xl font-bold text-gray-800 mb-6">轉移詳情</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-gray-500 text-sm mb-1">轉移日期</label>
                        <p id="result_transferDate" class="text-gray-800 font-medium"></p>
                    </div>
                    
                    <div>
                        <label class="block text-gray-500 text-sm mb-1">轉移單號</label>
                        <p id="result_transferId" class="text-gray-800 font-medium"></p>
                    </div>
                </div>
                
                <div class="mt-6">
                    <label class="block text-gray-500 text-sm mb-1">轉移備註</label>
                    <p id="result_transferNotes" class="text-gray-800"></p>
                </div>

                <div class="mt-6 p-4 bg-blue-50 rounded-md">
                    <p class="text-blue-800 text-sm">此轉移已成功完成，系統已更新雙方客戶的使用期限資料。</p>
                </div>
            </div>

            <!-- 列印按鈕 -->
            <div class="flex justify-center mt-8 space-x-4">
                <button id="printBtn" class="btn-primary text-white px-6 py-3 rounded-md font-medium flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                    </svg>
                    列印轉移單
                </button>
                <button id="downloadPdfBtn" class="btn-success text-white px-6 py-3 rounded-md font-medium flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                    </svg>
                    下載PDF檔案
                </button>
            </div>
        </div>

        <!-- 列印區域 -->
        <div id="printArea">
            <div class="print-container">
                <!-- 表頭 -->
                <div class="flex justify-between items-center mb-6 border-b pb-4">
                    <div class="flex items-center">
                        <!-- 今網智生活Logo -->
                        <div class="mr-4">
                            <!-- 使用內聯 SVG 避免跨域問題 -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 100 100" fill="#3b82f6">
                                <circle cx="50" cy="50" r="50" fill="#3B82F6"/>
                                <circle cx="50" cy="50" r="40" fill="white"/>
                                <path d="M50 20L30 80L70 80L50 20Z" fill="#3B82F6"/>
                            </svg>
                        </div>
                        <!-- 公司名稱和統編 -->
                        <div>
                            <h2 class="text-xl font-bold">智生活</h2>
                            <p class="text-gray-600">SmartDaily</p>
                            <p class="text-gray-600">統編 54307560</p>
                            <p class="text-gray-600">KNST Co., Ltd</p>
                            <p class="text-gray-600">今網智慧科技股份有限公司</p>
                        </div>
                    </div>
                    <!-- 版本號和申請日期 -->
                    <div class="text-right">
                        <p class="text-gray-600">版本:20250206_V1.0</p>
                        <p class="text-gray-600">申請日期: <span id="print_application_date"></span></p>
                    </div>
                </div>

                <!-- 標題 -->
                <div class="text-center mb-8">
                    <h1 class="text-2xl font-bold">異動申請書</h1>
                </div>

                <!-- 客戶資料區塊 (整合A客戶和B客戶的部分資訊，模仿PDF起始部分) -->
                <table class="print-table mb-8">
                    <tr>
                        <td class="bg-gray-50 w-1/6">客戶姓名</td>
                        <td class="w-1/3" id="print_transferor_name_main"></td>
                        <td class="bg-gray-50 w-1/6">社區名稱</td>
                        <td class="w-1/3">微笑之心</td> <!-- 假設社區名稱固定 -->
                    </tr>
                    <tr>
                        <td class="bg-gray-50">地址</td>
                        <td colspan="3" id="print_transferor_address_main"></td>
                    </tr>
                    <tr>
                        <td class="bg-gray-50">電話1</td>
                        <td id="print_transferor_phone_main"></td>
                        <td class="bg-gray-50">電話2</td>
                        <td></td> <!-- 假設電話2為空或不提供 -->
                    </tr>
                </table>

                <!-- 客戶編號與到期日 -->
                <div class="mb-8">
                    <p>客戶編號: <span id="print_transferor_id_main"></span> (今網智慧填寫)</p>
                    <p>到期日 <span id="print_transferor_expiry_main"></span> (今網智慧填寫)</p>
                </div>

                <!-- 異動項目(請勾選) - 月份轉讓 -->
                <div class="mb-8">
                    <h3 class="text-lg font-bold mb-4">異動項目(請勾選)</h3>
                    <p class="mb-2">
                        <input type="checkbox" checked style="transform: scale(1.2); margin-right: 5px;"> 月份轉讓
                        欲轉讓期間: <span id="print_transfer_period_start"></span>至<span id="print_transfer_period_end"></span> (今網智慧填寫)
                        轉讓天數: <span id="print_transfer_days_main"></span> (今網智慧填寫)
                    </p>
                    <p class="mb-2">
                        承接人: <span id="print_recipient_id_main"></span><span id="print_recipient_name_main"></span>
                        承接人到期日: <span id="print_recipient_current_expiry_main"></span> (今網智慧填寫)
                    </p>
                    <p class="mb-2">
                        承接人地址: <span id="print_recipient_address_main"></span>
                    </p>
                    <p class="mb-2">
                        轉讓天數: <span id="print_transfer_days_final"></span> 轉讓後到期日: <span id="print_recipient_newExpiry_final"></span> (今網智慧填寫)
                    </p>
                    <p class="mb-2">備註/其他約定事項: <span id="print_transfer_notes"></span></p>
                </div>

                <!-- 注意事項 -->
                <div class="mb-8 notice-box">
                    <h3 class="notice-title text-lg">【申請程序如下(未盡細項詳租用條款第七條各項):</h3>
                    <div class="notice-list">
                        <ol class="list-decimal pl-6 text-sm space-y-2">
                            <li>各項異動服務需填具申請書/並檢附登記人雙證件影本方可辦理。</li>
                            <li>網路服務到期日前45日內，不受理暫停申請/使用期間轉移之異動申請。</li>
                            <li>每次暫停期間最長1年，暫停復訊後需屆滿15天，方可再辦理暫停。</li>
                            <li>用戶有主分機者，辦理暫停則主分機將一併暫停。</li>
                            <li>網路暫停天數將如數延長於網路到期日之後。</li>
                            <li>接受月份轉移者，轉移之月份、天數不得再次轉移，亦不得列入退費計算。承接人享月份使用權益，退費權益仍屬原登記人，雙方因月份轉移而肇致糾紛，由轉移雙方當事人負責。</li>
                            <li>本申請書之登記人及承接人應確實填具上開資料，如有錯誤或偽冒，願負法律責任。上開資料，本公司僅作申辦異動業務及聯絡使用。</li>
                            <li>本公司保證依隱私權保護相關法令之規定，保護登記人及承接人所提供之資料，除依法律規定、法院命令或相關主管機關依法以書面申請，不得提供與第三人使用。</li>
                        </ol>
                    </div>
                </div>

                <!-- 回傳方式 -->
                <div class="mb-8 notice-box">
                    <p class="text-center mb-2 font-bold">回傳方式：本申請書(含證件)，方可透過以下方式回傳並來電412-8166(手機需加區碼)確認，避免遺漏。</p>
                    <div class="notice-list">
                        <ol class="list-decimal pl-6 text-sm">
                            <li>郵寄：40466-台中市北區太原北路130號10樓</li>
                            <li>MAIL：service@smartdaily.com.tw</li>
                        </ol>
                    </div>
                </div>

                <!-- 本人已詳閱並同意備註約定事項及租用條款 -->
                <div class="mt-8 mb-8 text-center">
                    <p>本人已詳閱並同意備註約定事項及租用條款</p>
                </div>

                <!-- 簽名欄 -->
                <div class="signature-box">
                    <div class="signature-cell">
                        <p class="mb-4">會辦單位</p>
                    </div>
                    <div class="signature-cell">
                        <p class="mb-4">主管</p>
                    </div>
                    <div class="signature-cell">
                        <p class="mb-4">服務人員</p>
                    </div>
                    <div class="signature-cell">
                        <p class="mb-4">用戶簽章</p>
                    </div>
                </div>

                <!-- 轉移單號 -->
                <div class="mt-8 text-right">
                    <p>轉移單號：<span id="print_transfer_id"></span></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 模擬客戶資料庫 - 已更新到期日為未來，方便測試
        const customerDatabase = {
            'A001': {
                name: '王小明',
                birthday: '1985-05-15',
                idNumber: 'A123456789',
                address: '台北市信義區信義路五段7號',
                phone: '0912-345-678',
                expiry: '2026-12-31' // 更新到期日
            },
            'A002': {
                name: '李小華',
                birthday: '1990-08-22',
                idNumber: 'B234567890',
                address: '新北市板橋區文化路一段88號',
                phone: '0923-456-789',
                expiry: '2026-10-15' // 更新到期日
            },
            'B001': {
                name: '張大為',
                birthday: '1982-03-10',
                idNumber: 'C345678901',
                address: '台中市西區民生路200號',
                phone: '0934-567-890',
                expiry: '2025-08-20' // 更新到期日
            },
            'B002': {
                name: '林美玲',
                birthday: '1988-11-30',
                idNumber: 'D456789012',
                address: '高雄市前鎮區中山路99號',
                phone: '0945-678-901',
                expiry: '2025-09-05' // 更新到期日
            }
        };

        // 顯示載入指示器
        function showLoading(message) {
            document.getElementById('loadingText').textContent = message || '處理中，請稍候...';
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        // 隱藏載入指示器
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // 計算兩個日期之間的天數差 (date2 - date1)
        function daysBetween(date1, date2) {
            const oneDay = 24 * 60 * 60 * 1000; // 一天的毫秒數
            const firstDate = new Date(date1);
            const secondDate = new Date(date2);
            // 為了確保日期比較不受時間影響，將時間部分歸零
            firstDate.setHours(0, 0, 0, 0);
            secondDate.setHours(0, 0, 0, 0);
            return Math.floor((secondDate.getTime() - firstDate.getTime()) / oneDay);
        }

        // 添加天數到日期
        function addDays(date, days) {
            const result = new Date(date);
            result.setDate(result.getDate() + parseInt(days));
            return result;
        }

        // 格式化日期為 YYYY-MM-DD
        function formatDate(date) {
            const d = new Date(date);
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // 格式化日期為顯示格式 (例如：2024年12月31日)
        function formatDisplayDate(dateStr) {
            if (!dateStr) return '';
            
            try {
                const d = new Date(dateStr);
                if (isNaN(d.getTime())) return dateStr; // 如果日期無效，直接返回原始字串
                
                const year = d.getFullYear();
                const month = String(d.getMonth() + 1).padStart(2, '0');
                const day = String(d.getDate()).padStart(2, '0');
                return `${year}年${month}月${day}日`;
            } catch (e) {
                return dateStr; // 如果發生錯誤，直接返回原始字串
            }
        }
        
        // 格式化日期為民國年格式 (例如：114年07月24日)
        function formatRepublicEraDate(date) {
            if (!date) return '';
            
            try {
                const d = new Date(date);
                if (isNaN(d.getTime())) return '';
                const year = d.getFullYear() - 1911; // 轉換為民國年
                const month = String(d.getMonth() + 1).padStart(2, '0');
                const day = String(d.getDate()).padStart(2, '0');
                return `${year}年${month}月${day}日`;
            } catch (e) {
                return '';
            }
        }

        // 生成隨機轉移單號
        function generateTransferId() {
            const date = new Date();
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
            return `T${year}${month}${day}${random}`;
        }

        // 將天數轉換為月份和天數
        function daysToMonthsAndDays(days) {
            if (days === null || isNaN(days)) return ''; // 處理 null 或非數字輸入
            
            days = parseInt(days);
            if (days < 0) return '0天'; // 負數天數顯示為0天

            const months = Math.floor(days / 30);
            const remainingDays = days % 30;
            
            if (months > 0 && remainingDays > 0) {
                return `${months}個月${remainingDays}天`;
            } else if (months > 0) {
                return `${months}個月`;
            } else {
                return `${days}天`;
            }
        }

        // 查詢A客戶資料
        document.getElementById('searchA').addEventListener('click', function() {
            const customerId = document.getElementById('customerA_id').value.trim();
            if (!customerId) {
                alert('請輸入客戶編號');
                return;
            }
            
            const customer = customerDatabase[customerId];
            
            if (customer) {
                document.getElementById('customerA_name').value = customer.name;
                document.getElementById('customerA_birthday').value = customer.birthday;
                document.getElementById('customerA_idNumber').value = customer.idNumber;
                document.getElementById('customerA_address').value = customer.address;
                document.getElementById('customerA_phone').value = customer.phone;
                document.getElementById('customerA_expiry').value = customer.expiry;
                
                // 計算剩餘天數 - 修正邏輯：如果到期日已過，則顯示 0 天
                const today = new Date();
                today.setHours(0, 0, 0, 0); // 正規化日期
                const expiryDate = new Date(customer.expiry);
                expiryDate.setHours(0, 0, 0, 0); // 正規化日期

                let daysLeft = 0;
                if (expiryDate.getTime() > today.getTime()) {
                    daysLeft = daysBetween(today, expiryDate);
                }
                document.getElementById('customerA_daysLeft').value = daysLeft;
                
                // 顯示已載入狀態
                document.getElementById('customerAStatus').classList.remove('hidden');
            } else {
                alert('找不到此客戶資料');
                // 清空相關欄位
                document.getElementById('customerA_name').value = '';
                document.getElementById('customerA_birthday').value = '';
                document.getElementById('customerA_idNumber').value = '';
                document.getElementById('customerA_address').value = '';
                document.getElementById('customerA_phone').value = '';
                document.getElementById('customerA_expiry').value = '';
                document.getElementById('customerA_daysLeft').value = '';
                document.getElementById('customerAStatus').classList.add('hidden');
            }
        });

        // 查詢B客戶資料
        document.getElementById('searchB').addEventListener('click', function() {
            const customerId = document.getElementById('customerB_id').value.trim();
            if (!customerId) {
                alert('請輸入客戶編號');
                return;
            }
            
            const customer = customerDatabase[customerId];
            
            if (customer) {
                document.getElementById('customerB_name').value = customer.name;
                document.getElementById('customerB_birthday').value = customer.birthday;
                document.getElementById('customerB_idNumber').value = customer.idNumber;
                document.getElementById('customerB_address').value = customer.address;
                document.getElementById('customerB_phone').value = customer.phone;
                document.getElementById('customerB_currentExpiry').value = customer.expiry;
                
                // 顯示已載入狀態
                document.getElementById('customerBStatus').classList.remove('hidden');
            } else {
                alert('找不到此客戶資料');
                document.getElementById('customerB_name').value = '';
                document.getElementById('customerB_birthday').value = '';
                document.getElementById('customerB_idNumber').value = '';
                document.getElementById('customerB_address').value = '';
                document.getElementById('customerB_phone').value = '';
                document.getElementById('customerB_currentExpiry').value = '';
                document.getElementById('customerB_newExpiry').value = '';
                document.getElementById('customerBStatus').classList.add('hidden');
            }
        });

        // 計算轉移資訊
        document.getElementById('calculateBtn').addEventListener('click', function() {
            const transferDate = document.getElementById('transferDate').value;
            const customerAExpiry = document.getElementById('customerA_expiry').value;
            const customerBExpiry = document.getElementById('customerB_currentExpiry').value;
            
            if (!transferDate || !customerAExpiry || !customerBExpiry) {
                alert('請先完整載入A、B客戶資料並選擇轉移日期！');
                return;
            }
            
            const transferDate_obj = new Date(transferDate);
            transferDate_obj.setHours(0, 0, 0, 0);
            const customerAExpiry_obj = new Date(customerAExpiry);
            customerAExpiry_obj.setHours(0, 0, 0, 0);

            // 驗證轉移日期必須早於A客戶的使用期限
            if (transferDate_obj.getTime() >= customerAExpiry_obj.getTime()) {
                alert('轉移日期必須早於A客戶的使用期限！');
                document.getElementById('transferDays').value = '無效日期';
                document.getElementById('customerB_newExpiry').value = '';
                return;
            }
            
            // 計算A客戶從轉移日到到期日的剩餘天數 (正向天數)
            const daysToTransfer = daysBetween(transferDate_obj, customerAExpiry_obj);
            
            // 顯示轉移天數（月份+天數格式）
            const transferPeriod = daysToMonthsAndDays(daysToTransfer);
            document.getElementById('transferDays').value = transferPeriod;
            
            // 計算B客戶的新到期日
            const newExpiryDate = addDays(new Date(customerBExpiry), daysToTransfer);
            document.getElementById('customerB_newExpiry').value = formatDate(newExpiryDate);
        });

        // 確認轉移
        document.getElementById('transferBtn').addEventListener('click', function() {
            const customerAId = document.getElementById('customerA_id').value;
            const customerBId = document.getElementById('customerB_id').value;
            const transferDate = document.getElementById('transferDate').value;
            const transferDays = document.getElementById('transferDays').value;
            const transferNotes = document.getElementById('transferNotes').value;
            const customerAExpiry = document.getElementById('customerA_expiry').value; // A客戶原始到期日
            const customerBCurrentExpiry = document.getElementById('customerB_currentExpiry').value; // B客戶原始到期日
            const customerBNewExpiry = document.getElementById('customerB_newExpiry').value; // B客戶新到期日
            
            // 檢查必填欄位
            if (!customerAId || !customerBId || !transferDate || !transferDays || !customerAExpiry || !customerBCurrentExpiry || !customerBNewExpiry) {
                alert('請先完整填寫所有轉移資訊並計算！');
                return;
            }
            
            // 再次驗證轉移天數是否已計算且有效
            if (parseInt(daysBetween(transferDate, customerAExpiry)) <= 0) { // 使用原始的daysBetween確保是正數天
                alert('轉移天數必須大於0，請先計算轉移資訊！');
                return;
            }
            
            // 生成轉移單號
            const transferId = generateTransferId();
            
            // 隱藏表單，顯示結果
            document.getElementById('inputForm').classList.add('hidden');
            document.getElementById('resultArea').classList.remove('hidden');
            
            // 設置轉移成功訊息
            document.getElementById('resultMessage').textContent = 
                `已成功將 ${document.getElementById('customerA_name').value} (編號: ${customerAId}) 的 ${transferDays} 使用權限轉移給 ${document.getElementById('customerB_name').value} (編號: ${customerBId})。`;
            
            // 填充轉讓戶資料
            document.getElementById('result_transferor_id').textContent = customerAId;
            document.getElementById('result_transferor_name').textContent = document.getElementById('customerA_name').value;
            document.getElementById('result_transferor_birthday').textContent = formatDisplayDate(document.getElementById('customerA_birthday').value);
            document.getElementById('result_transferor_idNumber').textContent = document.getElementById('customerA_idNumber').value;
            document.getElementById('result_transferor_address').textContent = document.getElementById('customerA_address').value;
            document.getElementById('result_transferor_phone').textContent = document.getElementById('customerA_phone').value;
            document.getElementById('result_transferor_expiry').textContent = formatDisplayDate(customerAExpiry);
            document.getElementById('result_transferPeriod').textContent = transferDays;
            
            // 填充承接者資料
            document.getElementById('result_recipient_id').textContent = customerBId;
            document.getElementById('result_recipient_name').textContent = document.getElementById('customerB_name').value;
            document.getElementById('result_recipient_birthday').textContent = formatDisplayDate(document.getElementById('customerB_birthday').value);
            document.getElementById('result_recipient_idNumber').textContent = document.getElementById('customerB_idNumber').value;
            document.getElementById('result_recipient_address').textContent = document.getElementById('customerB_address').value;
            document.getElementById('result_recipient_phone').textContent = document.getElementById('customerB_phone').value;
            document.getElementById('result_recipient_oldExpiry').textContent = formatDisplayDate(customerBCurrentExpiry);
            document.getElementById('result_recipient_newExpiry').textContent = formatDisplayDate(customerBNewExpiry);
            
            // 填充轉移詳情
            document.getElementById('result_transferDate').textContent = formatDisplayDate(transferDate);
            document.getElementById('result_transferId').textContent = transferId;
            document.getElementById('result_transferNotes').textContent = transferNotes || '無';
            
            // 填充列印區域資料 (在確認轉移後立即填充，確保數據最新)
            populatePrintArea();
        });

        // 返回表單
        document.getElementById('backToForm').addEventListener('click', function() {
            document.getElementById('resultArea').classList.add('hidden');
            document.getElementById('inputForm').classList.remove('hidden');
            // 重置表單數據
            document.getElementById('resetBtn').click();
        });

        // 填充列印區域的數據函式
        function populatePrintArea() {
            // 從輸入欄位和結果顯示區域獲取數據
            const customerAId = document.getElementById('customerA_id').value;
            const customerAName = document.getElementById('customerA_name').value;
            const customerAPhone = document.getElementById('customerA_phone').value;
            const customerAAddress = document.getElementById('customerA_address').value;
            const customerAExpiry = document.getElementById('customerA_expiry').value; // YYYY-MM-DD
            
            const customerBId = document.getElementById('customerB_id').value;
            const customerBName = document.getElementById('customerB_name').value;
            const customerBAddress = document.getElementById('customerB_address').value;
            const customerBCurrentExpiry = document.getElementById('customerB_currentExpiry').value; // YYYY-MM-DD
            const customerBNewExpiry = document.getElementById('customerB_newExpiry').value; // YYYY-MM-DD

            const transferDate = document.getElementById('transferDate').value; // YYYY-MM-DD
            const transferDays = document.getElementById('transferDays').value; // 已經是 "X個月Y天" 格式
            const transferNotes = document.getElementById('transferNotes').value;
            const transferId = document.getElementById('result_transferId').textContent; // 從結果區獲取已生成的單號

            // 填充表頭
            document.getElementById('print_application_date').textContent = formatRepublicEraDate(new Date()); // 申請日期用當前日期民國年

            // 填充客戶資料區塊 (模仿PDF起始部分)
            document.getElementById('print_transferor_name_main').textContent = customerAName;
            document.getElementById('print_transferor_address_main').textContent = customerAAddress;
            document.getElementById('print_transferor_phone_main').textContent = customerAPhone;
            document.getElementById('print_transferor_id_main').textContent = customerAId;
            document.getElementById('print_transferor_expiry_main').textContent = formatDisplayDate(customerAExpiry);

            // 填充異動項目 - 月份轉讓
            document.getElementById('print_transfer_period_start').textContent = formatDisplayDate(transferDate);
            document.getElementById('print_transfer_period_end').textContent = formatDisplayDate(customerAExpiry);
            document.getElementById('print_transfer_days_main').textContent = transferDays; // 轉讓天數 (X個月Y天)

            document.getElementById('print_recipient_id_main').textContent = customerBId;
            document.getElementById('print_recipient_name_main').textContent = customerBName;
            document.getElementById('print_recipient_current_expiry_main').textContent = formatDisplayDate(customerBCurrentExpiry); // 承接人到期日 (B客戶原始到期日)

            document.getElementById('print_recipient_address_main').textContent = customerBAddress;

            document.getElementById('print_transfer_days_final').textContent = transferDays; // 轉讓天數 (X個月Y天)
            document.getElementById('print_recipient_newExpiry_final').textContent = formatDisplayDate(customerBNewExpiry); // 轉讓後新到期日

            document.getElementById('print_transfer_notes').textContent = transferNotes || '無'; // 備註

            // 填充簽名欄下方的轉移單號
            document.getElementById('print_transfer_id').textContent = transferId;
        }

        // 列印轉移單
        document.getElementById('printBtn').addEventListener('click', function() {
            // 確保列印區域數據已填充
            populatePrintArea();

            // 顯示列印區域
            const printArea = document.getElementById('printArea');
            printArea.classList.add('show-for-print'); // 顯示列印區域

            // 觸發瀏覽器列印
            window.print();

            // 列印完成後隱藏列印區域
            // 使用 setTimeout 確保列印對話框關閉後再隱藏，避免閃爍
            setTimeout(function() {
                printArea.classList.remove('show-for-print'); // 隱藏列印區域
            }, 1000); // 延遲1秒
        });

        // 下載PDF檔案 (使用html2canvas將列印區域轉換為圖像，再用jsPDF生成PDF)
        document.getElementById('downloadPdfBtn').addEventListener('click', async function() {
            showLoading('正在生成PDF檔案，請稍候...');
            
            const customerAId = document.getElementById('customerA_id').value;
            const customerBId = document.getElementById('customerB_id').value;
            const transferId = document.getElementById('result_transferId').textContent; // 從結果區獲取已生成的單號

            // 確保列印區域數據已填充
            populatePrintArea();

            const printArea = document.getElementById('printArea');
            printArea.classList.add('show-for-print'); // 顯示列印區域以便 html2canvas 渲染

            // 為了避免渲染時影響頁面滾動，將要渲染的元素暫時移出可視區域
            const tempRenderDiv = document.createElement('div');
            tempRenderDiv.style.position = 'absolute';
            tempRenderDiv.style.left = '-9999px';
            tempRenderDiv.style.top = '-9999px';
            tempRenderDiv.style.width = printArea.offsetWidth + 'px'; // 保持與 printArea 相同的寬度
            tempRenderDiv.style.height = printArea.offsetHeight + 'px'; // 保持與 printArea 相同的高度
            tempRenderDiv.innerHTML = printArea.innerHTML; // 複製 printArea 的內容
            document.body.appendChild(tempRenderDiv);

            try {
                // 使用 html2canvas 將臨時容器的內容轉換為 Canvas
                const canvas = await html2canvas(tempRenderDiv, {
                    scale: 2, // 提高解析度以獲得更清晰的 PDF
                    useCORS: true, // 允許跨域圖片（例如 Google Fonts）
                    logging: false, // 關閉 html2canvas 的日誌
                    backgroundColor: '#ffffff' // 確保背景為白色
                });

                // 將 canvas 轉換為 PNG 圖像數據
                const imgData = canvas.toDataURL('image/png');
                
                // 創建 jsPDF 實例
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4'); // 'p' 縱向, 'mm' 毫米單位, 'a4' A4 紙張大小

                const imgWidth = 210; // A4 紙張寬度 (210mm)
                const pageHeight = 297; // A4 紙張高度 (297mm)
                const imgHeight = canvas.height * imgWidth / canvas.width; // 根據 A4 寬度等比例計算圖片高度

                let heightLeft = imgHeight;
                let position = 0;

                // 如果內容超過一頁，則分頁
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                // 儲存 PDF 檔案
                pdf.save(`月份轉移申請書_${customerAId}_${customerBId}_${transferId}.pdf`);

            } catch (error) {
                console.error('生成或下載PDF時發生錯誤:', error);
                alert('生成或下載PDF檔案時發生錯誤，請檢查控制台。');
            } finally {
                // 無論成功或失敗，都移除臨時渲染容器並隱藏列印區域和載入指示器
                document.body.removeChild(tempRenderDiv);
                printArea.classList.remove('show-for-print');
                hideLoading();
            }
        });

        // 重置表單
        document.getElementById('resetBtn').addEventListener('click', function() {
            // 重置A客戶資料
            document.getElementById('customerA_id').value = '';
            document.getElementById('customerA_name').value = '';
            document.getElementById('customerA_birthday').value = '';
            document.getElementById('customerA_idNumber').value = '';
            document.getElementById('customerA_address').value = '';
            document.getElementById('customerA_phone').value = '';
            document.getElementById('customerA_expiry').value = '';
            document.getElementById('customerA_daysLeft').value = '';
            document.getElementById('customerAStatus').classList.add('hidden');
            
            // 重置B客戶資料
            document.getElementById('customerB_id').value = '';
            document.getElementById('customerB_name').value = '';
            document.getElementById('customerB_birthday').value = '';
            document.getElementById('customerB_idNumber').value = '';
            document.getElementById('customerB_address').value = '';
            document.getElementById('customerB_phone').value = '';
            document.getElementById('customerB_currentExpiry').value = '';
            document.getElementById('customerB_newExpiry').value = '';
            document.getElementById('customerBStatus').classList.add('hidden');
            
            // 重置轉移設定
            document.getElementById('transferDate').value = formatDate(new Date()); // 預設為今天
            document.getElementById('transferDays').value = '';
            document.getElementById('transferNotes').value = '';

            // 清空結果顯示區域
            document.getElementById('result_transferor_id').textContent = '';
            document.getElementById('result_transferor_name').textContent = '';
            document.getElementById('result_transferor_birthday').textContent = '';
            document.getElementById('result_transferor_idNumber').textContent = '';
            document.getElementById('result_transferor_address').textContent = '';
            document.getElementById('result_transferor_phone').textContent = '';
            document.getElementById('result_transferor_expiry').textContent = '';
            document.getElementById('result_transferPeriod').textContent = '';
            document.getElementById('result_recipient_id').textContent = '';
            document.getElementById('result_recipient_name').textContent = '';
            document.getElementById('result_recipient_birthday').textContent = '';
            document.getElementById('result_recipient_idNumber').textContent = '';
            document.getElementById('result_recipient_address').textContent = '';
            document.getElementById('result_recipient_phone').textContent = '';
            document.getElementById('result_recipient_oldExpiry').textContent = '';
            document.getElementById('result_recipient_newExpiry').textContent = '';
            document.getElementById('result_transferDate').textContent = '';
            document.getElementById('result_transferId').textContent = '';
            document.getElementById('result_transferNotes').textContent = '';
            document.getElementById('resultMessage').textContent = '';

            // 隱藏結果區域，顯示輸入表單
            document.getElementById('resultArea').classList.add('hidden');
            document.getElementById('inputForm').classList.remove('hidden');
        });

        // 設置今天日期為轉移日期的預設值
        document.getElementById('transferDate').value = formatDate(new Date());
    </script>
</body>
</html>
