<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NotebookLM æ™ºæ…§æ¸¬é©—ç³»çµ±</title>
    <!-- Tailwind CSS (æ¨£å¼åº«) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-800">

    <!-- ä¸»å®¹å™¨ -->
    <div id="app" class="flex flex-col items-center justify-center min-h-screen p-4">
        <!-- å…§å®¹æœƒç”± JavaScript å‹•æ…‹æ’å…¥é€™è£¡ -->
    </div>

    <script>
        // ==========================================
        // è¨­å®šå€åŸŸ (è«‹ä¿®æ”¹é€™è£¡)
        // ==========================================
        
        // è«‹å¡«å…¥æ‚¨çš„ Google Apps Script ç¶²é æ‡‰ç”¨ç¨‹å¼ç¶²å€
        const GAS_URL = "https://script.google.com/macros/s/AKfycbwBS1cRZVuZZpbVpOfgs_Yg38liCu4u9Eyg58MTY0J0mRFqUklmmzwGkYALcEU2JTweKw/exec";

        // å¦‚æœæƒ³å…ˆæ¸¬è©¦ç•«é¢ä¸æƒ³é€£ Google Sheetï¼ŒæŠŠé€™å€‹è¨­ç‚º true
        const USE_MOCK_DATA = false;

        // ==========================================
        // æ¨¡æ“¬è³‡æ–™ (Mock Data)
        // ==========================================
        const MOCK_DATA = [
            {
                id: 1,
                question: "ç¯„ä¾‹é¡Œç›®ï¼šé€™æ˜¯ä¸€å€‹ HTML ç‰ˆæœ¬çš„æ¸¬é©—å—ï¼Ÿ",
                options: ["æ˜¯çš„", "ä¸æ˜¯", "ä¸ç¢ºå®š", "å¯èƒ½æ˜¯ React"],
                correctAnswer: "æ˜¯çš„",
                explanation: "NotebookLM è§£æï¼šä½ ç¾åœ¨çœ‹åˆ°çš„ç¢ºå¯¦æ˜¯ç´” HTML + JavaScript çš„ç‰ˆæœ¬ï¼Œæ²’æœ‰ä½¿ç”¨ Reactã€‚"
            },
            {
                id: 2,
                question: "è¦å¦‚ä½•æŠ“å– Google Sheet è³‡æ–™ï¼Ÿ",
                options: ["ç”¨æ‰‹æŠ“", "ä½¿ç”¨ fetch API", "æ‰“é›»è©±çµ¦ Google", "ä½¿ç”¨å¿ƒé›»æ„Ÿæ‡‰"],
                correctAnswer: "ä½¿ç”¨ fetch API",
                explanation: "NotebookLM è§£æï¼šåœ¨å‰ç«¯ç¶²é ä¸­ï¼Œæˆ‘å€‘ä½¿ç”¨ JavaScript çš„ fetch() å‡½å¼ä¾†å‘å¾Œç«¯ Google Apps Script ç™¼é€è«‹æ±‚ã€‚"
            }
        ];

        // ==========================================
        // ç‹€æ…‹ç®¡ç† (State)
        // ==========================================
        let state = {
            view: 'welcome', // welcome, loading, quiz, result, error
            userName: '',
            questions: [],
            currentQuestionIndex: 0,
            userAnswers: {}, // { questionId: 'Selected Option' }
            score: 0,
            errorMsg: ''
        };

        // ==========================================
        // æ ¸å¿ƒé‚è¼¯ (Logic)
        // ==========================================

        // æ´—ç‰Œæ¼”ç®—æ³•
        function shuffleArray(array) {
            let newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // é–‹å§‹æŒ‰éˆ•é»æ“Š
        function handleStart() {
            const nameInput = document.getElementById('nameInput');
            const name = nameInput.value.trim();
            if (!name) {
                alert('è«‹è¼¸å…¥æ‚¨çš„å§“å');
                return;
            }
            state.userName = name;
            fetchQuestions();
        }

        // æŠ“å–é¡Œç›®
        async function fetchQuestions() {
            renderLoading();
            
            // æª¢æŸ¥ URL æ˜¯å¦æœ‰è¨­å®š
            if (!USE_MOCK_DATA && (GAS_URL.includes("YOUR_GOOGLE") || GAS_URL === "")) {
                state.errorMsg = "å°šæœªè¨­å®š Google Apps Script URLï¼è«‹æ‰“é–‹ HTML åŸå§‹ç¢¼ä¿®æ”¹ GAS_URL è®Šæ•¸ã€‚";
                renderError();
                return;
            }

            try {
                let data = [];
                if (USE_MOCK_DATA) {
                    await new Promise(r => setTimeout(r, 800)); // æ¨¡æ“¬å»¶é²
                    data = MOCK_DATA;
                } else {
                    const response = await fetch(GAS_URL);
                    const text = await response.text();
                    
                    try {
                        data = JSON.parse(text);
                    } catch (e) {
                        // å¦‚æœå›å‚³çš„ä¸æ˜¯ JSONï¼Œé€šå¸¸æ˜¯æ¬Šé™éŒ¯èª¤ (å›å‚³äº† Google ç™»å…¥é é¢çš„ HTML)
                        console.error("è§£æå¤±æ•—ï¼ŒåŸå§‹å›æ‡‰:", text);
                        if (text.includes("Google Drive") || text.includes("sign in")) {
                            throw new Error("æ¬Šé™éŒ¯èª¤ï¼šè«‹ç¢ºèª Google Script éƒ¨ç½²æ¬Šé™æ˜¯å¦è¨­ç‚ºã€Œä»»ä½•äºº (Anyone)ã€ã€‚");
                        } else {
                            throw new Error("è³‡æ–™æ ¼å¼éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥å¾Œç«¯ç¨‹å¼ç¢¼ã€‚");
                        }
                    }
                }

                if (!Array.isArray(data) || data.length === 0) {
                    throw new Error("è®€å–æˆåŠŸï¼Œä½†æ²’æœ‰é¡Œç›®è³‡æ–™ã€‚è«‹æª¢æŸ¥ Google Sheetã€‚");
                }

                state.questions = shuffleArray(data);
                state.view = 'quiz';
                renderQuiz();

            } catch (err) {
                console.error(err);
                state.errorMsg = err.message || "æœªçŸ¥éŒ¯èª¤";
                renderError();
            }
        }

        // é¸æ“‡ç­”æ¡ˆ
        function selectAnswer(option) {
            const currentQ = state.questions[state.currentQuestionIndex];
            state.userAnswers[currentQ.id] = option;
            renderQuiz(); // é‡æ–°æ¸²æŸ“ä»¥æ›´æ–°é¸å–ç‹€æ…‹
        }

        // ä¸‹ä¸€é¡Œ
        function handleNext() {
            if (state.currentQuestionIndex < state.questions.length - 1) {
                state.currentQuestionIndex++;
                renderQuiz();
            } else {
                calculateAndSubmit();
            }
        }

        // è¨ˆç®—åˆ†æ•¸ä¸¦æäº¤
        async function calculateAndSubmit() {
            let correctCount = 0;
            state.questions.forEach(q => {
                if (state.userAnswers[q.id] === q.correctAnswer) {
                    correctCount++;
                }
            });

            state.score = Math.round((correctCount / state.questions.length) * 100);
            state.view = 'submitting';
            renderLoading('æ­£åœ¨å„²å­˜æˆç¸¾...');

            if (!USE_MOCK_DATA) {
                try {
                    // ä½¿ç”¨ no-cors æ¨¡å¼ç™¼é€ POSTï¼Œé›–ç„¶æ‹¿ä¸åˆ°å›æ‡‰å…§å®¹ï¼Œä½†èƒ½ç¢ºä¿ç™¼é€æˆåŠŸä¸”ä¸è¢«ç€è¦½å™¨æ“‹ä¸‹
                    await fetch(GAS_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: {
                            'Content-Type': 'text/plain;charset=utf-8',
                        },
                        body: JSON.stringify({
                            name: state.userName,
                            score: state.score
                        })
                    });
                } catch (e) {
                    console.error("æäº¤å¤±æ•—", e);
                    // å³ä½¿æäº¤å¤±æ•—ä¹Ÿé¡¯ç¤ºçµæœï¼Œä»¥å…å¡ä½
                }
            } else {
                await new Promise(r => setTimeout(r, 1000));
            }

            state.view = 'result';
            renderResult();
        }

        function restart() {
            state.userName = '';
            state.currentQuestionIndex = 0;
            state.userAnswers = {};
            state.score = 0;
            state.view = 'welcome';
            renderWelcome();
        }

        // ==========================================
        // ç•«é¢æ¸²æŸ“å‡½å¼ (Render Views)
        // ==========================================
        const app = document.getElementById('app');

        // 1. æ­¡è¿ç•«é¢
        function renderWelcome() {
            app.innerHTML = `
                <div class="bg-white max-w-md w-full rounded-2xl shadow-xl overflow-hidden fade-in">
                    <div class="bg-gradient-to-br from-blue-600 to-indigo-700 p-8 text-center">
                        <svg class="w-16 h-16 text-white/90 mx-auto mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                        <h1 class="text-3xl font-bold text-white mb-2 tracking-tight">ç·šä¸Šæ¸¬é©—ç³»çµ±</h1>
                        <p class="text-blue-100 font-medium">NotebookLM æ™ºæ…§å‡ºé¡Œ (HTMLç‰ˆ)</p>
                    </div>
                    <div class="p-8 space-y-6">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">è«‹è¼¸å…¥æ‚¨çš„å§“å</label>
                            <input type="text" id="nameInput" class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="Ex: ç‹å°æ˜">
                        </div>
                        <button onclick="handleStart()" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-3 px-6 rounded-lg transition duration-200 flex items-center justify-center gap-2 shadow-lg hover:shadow-xl transform active:scale-95">
                            é–‹å§‹æ¸¬é©— 
                            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                        </button>
                    </div>
                </div>
            `;
        }

        // 2. è¼‰å…¥ä¸­ç•«é¢
        function renderLoading(msg = 'æ­£åœ¨å¾é›²ç«¯è¼‰å…¥è©¦é¡Œ...') {
            app.innerHTML = `
                <div class="flex flex-col items-center justify-center fade-in">
                    <svg class="w-12 h-12 text-blue-600 animate-spin mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
                    <p class="text-slate-600 font-medium animate-pulse">${msg}</p>
                </div>
            `;
        }

        // 3. éŒ¯èª¤ç•«é¢
        function renderError() {
            app.innerHTML = `
                <div class="bg-white max-w-md w-full rounded-2xl shadow-xl p-8 border-l-4 border-red-500 fade-in">
                    <div class="flex items-center gap-3 mb-4 text-red-600">
                        <svg class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>
                        <h2 class="text-xl font-bold">ç™¼ç”ŸéŒ¯èª¤</h2>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg text-sm text-red-800 font-mono mb-6 break-words">${state.errorMsg}</div>
                    <button onclick="restart()" class="w-full bg-slate-900 text-white font-bold py-3 rounded-lg hover:bg-slate-800 transition">é‡æ–°æ•´ç†</button>
                </div>
            `;
        }

        // 4. æ¸¬é©—ç•«é¢
        function renderQuiz() {
            const currentQ = state.questions[state.currentQuestionIndex];
            const progress = Math.round(((state.currentQuestionIndex + 1) / state.questions.length) * 100);
            const isAnswered = state.userAnswers[currentQ.id] !== undefined;

            // ç”¢ç”Ÿé¸é …çš„ HTML
            const optionsHtml = currentQ.options.map((option, idx) => {
                const isSelected = state.userAnswers[currentQ.id] === option;
                const letter = String.fromCharCode(65 + idx);
                const borderClass = isSelected ? 'border-blue-500 bg-blue-50 text-blue-800' : 'border-slate-100 hover:border-blue-200 hover:bg-slate-50 text-slate-600';
                const circleClass = isSelected ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-400 group-hover:bg-blue-100 group-hover:text-blue-600';

                return `
                    <button onclick="selectAnswer('${option}')" class="w-full text-left p-4 rounded-xl border-2 transition-all duration-200 flex items-center group ${borderClass} mb-3">
                        <span class="flex items-center justify-center w-8 h-8 rounded-full text-sm font-bold mr-3 transition-colors ${circleClass}">
                            ${letter}
                        </span>
                        <span class="font-medium text-lg">${option}</span>
                    </button>
                `;
            }).join('');

            // ä¸‹ä¸€é¡ŒæŒ‰éˆ•æ¨£å¼
            const nextBtnClass = isAnswered 
                ? 'bg-blue-600 text-white hover:bg-blue-700 shadow-lg hover:shadow-xl hover:-translate-y-0.5' 
                : 'bg-slate-200 text-slate-400 cursor-not-allowed';
            const nextBtnText = state.currentQuestionIndex === state.questions.length - 1 ? 'æäº¤è©¦å·' : 'ä¸‹ä¸€é¡Œ';

            app.innerHTML = `
                <div class="w-full max-w-2xl fade-in">
                    <!-- é€²åº¦æ¢ -->
                    <div class="mb-6">
                        <div class="flex justify-between text-sm text-slate-500 mb-2 font-medium">
                            <span>Question ${state.currentQuestionIndex + 1} <span class="text-slate-300">/</span> ${state.questions.length}</span>
                            <span>${progress}%</span>
                        </div>
                        <div class="h-2.5 bg-slate-200 rounded-full overflow-hidden">
                            <div class="h-full bg-blue-600 transition-all duration-500 ease-out rounded-full" style="width: ${progress}%"></div>
                        </div>
                    </div>

                    <!-- é¡Œç›®å¡ç‰‡ -->
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 md:p-8 mb-6">
                        <h2 class="text-xl md:text-2xl font-bold text-slate-800 mb-8 leading-relaxed">${currentQ.question}</h2>
                        <div class="space-y-3">
                            ${optionsHtml}
                        </div>
                    </div>

                    <div class="flex justify-end">
                        <button id="nextBtn" onclick="handleNext()" ${!isAnswered ? 'disabled' : ''} class="px-8 py-3 rounded-lg font-bold text-lg transition-all transform ${nextBtnClass}">
                            ${nextBtnText}
                        </button>
                    </div>
                </div>
            `;
        }

        // 5. çµæœç•«é¢
        function renderResult() {
            // ç”¢ç”Ÿè©³è§£åˆ—è¡¨ HTML
            const reviewHtml = state.questions.map((q, idx) => {
                const userAnswer = state.userAnswers[q.id];
                const isCorrect = userAnswer === q.correctAnswer;
                const borderClass = isCorrect ? 'border-green-500' : 'border-red-500';
                const icon = isCorrect 
                    ? `<svg class="w-7 h-7 text-green-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>` 
                    : `<svg class="w-7 h-7 text-red-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>`;

                // è©³è§£å€å¡Š (NotebookLM)
                let explanationHtml = '';
                if (!isCorrect && q.explanation) {
                    explanationHtml = `
                        <div class="mt-2 bg-gradient-to-br from-amber-50 to-orange-50/50 rounded-xl p-5 border border-amber-100 shadow-sm">
                            <h5 class="text-amber-700 font-bold text-sm mb-3 flex items-center gap-2 uppercase tracking-wide">
                                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                                NotebookLM æ™ºæ…§æŒ‡å°
                            </h5>
                            <p class="text-slate-700 text-sm leading-7 text-justify">${q.explanation}</p>
                        </div>
                    `;
                } else if (isCorrect && q.explanation) {
                     explanationHtml = `<div class="mt-2 text-slate-500 text-sm italic pl-1"><p>ğŸ’¡ ${q.explanation}</p></div>`;
                }

                // æ­£ç¢ºç­”æ¡ˆé¡¯ç¤ºé‚è¼¯
                const correctAnswerDisplay = !isCorrect 
                    ? `<div class="flex items-center gap-2 text-slate-700"><span class="font-bold shrink-0">æ­£ç¢ºç­”æ¡ˆ:</span><span class="font-mono text-green-700">${q.correctAnswer}</span></div>` 
                    : '';

                return `
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden transition hover:shadow-md mb-6">
                        <div class="p-6 border-l-[6px] ${borderClass}">
                            <div class="flex items-start gap-4">
                                <div class="mt-1 shrink-0">${icon}</div>
                                <div class="flex-1 min-w-0">
                                    <span class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block">Question ${idx + 1}</span>
                                    <h4 class="text-lg font-bold text-slate-800 mb-4 leading-snug">${q.question}</h4>
                                    
                                    <div class="flex flex-col sm:flex-row gap-3 text-sm mb-5 bg-slate-50 p-3 rounded-lg">
                                        <div class="flex items-center gap-2 ${isCorrect ? 'text-green-700' : 'text-red-700'}">
                                            <span class="font-bold shrink-0">ä½ çš„ç­”æ¡ˆ:</span> 
                                            <span class="font-mono">${userAnswer}</span>
                                        </div>
                                        ${correctAnswerDisplay}
                                    </div>
                                    ${explanationHtml}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            app.innerHTML = `
                <div class="w-full max-w-3xl fade-in">
                    <div class="bg-white rounded-2xl shadow-lg border border-slate-100 p-8 text-center mb-8 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500"></div>
                        <div class="inline-flex items-center justify-center w-24 h-24 bg-yellow-50 rounded-full mb-4 ring-8 ring-yellow-50/50">
                            <svg class="w-12 h-12 text-yellow-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>
                        </div>
                        <h2 class="text-3xl font-bold text-slate-800 mb-2">æ¸¬é©—å®Œæˆï¼</h2>
                        <p class="text-slate-500 mb-6 font-medium text-lg">${state.userName} çš„æœ€çµ‚æˆç¸¾</p>
                        <div class="text-7xl font-black text-slate-800 mb-8 tracking-tighter">
                            ${state.score}<span class="text-3xl text-slate-400 font-normal ml-1">/100</span>
                        </div>
                        <button onclick="restart()" class="inline-flex items-center gap-2 text-slate-600 hover:text-blue-600 font-bold transition-colors py-2 px-4 rounded-lg hover:bg-slate-50">
                            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 2v6h-6"/><path d="M3 12a9 9 0 0 1 15-6.7L21 8"/><path d="M3 22v-6h6"/><path d="M21 12a9 9 0 0 1-15 6.7L3 16"/></svg> 
                            é‡æ–°æ¸¬é©—
                        </button>
                    </div>

                    <div class="space-y-6">
                        <div class="flex items-center gap-3 ml-1 mb-2">
                            <div class="w-1 h-6 bg-blue-600 rounded-full"></div>
                            <h3 class="text-xl font-bold text-slate-800">è©³ç´°è§£æèˆ‡æŒ‡å°</h3>
                        </div>
                        ${reviewHtml}
                    </div>
                </div>
            `;
        }

        // åˆå§‹åŒ–
        renderWelcome();

    </script>
</body>
</html>
