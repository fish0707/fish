// Google Apps Script Web App URL
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxH3BOlDFBJUxAg8IchvAX7xZ6rnSkIdutSjSUcZ0er2SaBK9X41GfegMuRQWojQkg1-Q/exec';

/**
 * 從網頁表單收集所有資料
 * @returns {Object} 包含所有表單資料的物件
 */
function collectFormData() {
    const formData = {
        '客編': document.querySelector('input[placeholder="請輸入客戶編號"]')?.value || '',
        '姓名': document.querySelector('input[placeholder="請輸入姓名"]')?.value || '',
        '地址': document.querySelector('input[placeholder="請輸入地址"]')?.value || '',
        '新客編': '',
        '新姓名': '',
        '新地址': '',
        '轉移區間': '',
        '轉移時間': '',
        '轉移後到期日': ''
    };
    
    const allInputs = document.querySelectorAll('input');
    
    if (allInputs.length >= 32) {
        formData['客編'] = allInputs[2]?.value || '';
        formData['姓名'] = allInputs[4]?.value || '';
        formData['地址'] = allInputs[6]?.value || '';
        formData['新客編'] = allInputs[15]?.value || '';
        formData['新姓名'] = allInputs[17]?.value || '';
        formData['新地址'] = allInputs[19]?.value || '';
        formData['轉移區間'] = allInputs[27]?.value || '';
        formData['轉移時間'] = allInputs[29]?.value || '';
        formData['轉移後到期日'] = allInputs[25]?.value || '';
    }
    
    return formData;
}

/**
 * 發送資料到 Google Apps Script
 * @param {Object} formData - 表單資料
 */
async function sendDataToGoogleAppsScript(formData) {
    try {
        console.log('準備發送資料到 Google Apps Script:', formData);
        
        const response = await fetch(WEB_APP_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData),
            mode: 'cors' // 允許跨域請求
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        console.log('Google Apps Script 回應:', result);
        
        if (result.success) {
            showMessage('資料已成功提交並更新到 Google 試算表！', 'success');
        } else {
            showMessage('提交失敗：' + result.message, 'error');
        }
        
    } catch (error) {
        console.error('發送資料到 Google Apps Script 時發生錯誤:', error);
        showMessage('提交失敗：' + error.message, 'error');
    }
}

/**
 * 顯示訊息
 * @param {string} message - 顯示的訊息
 * @param {string} type - 訊息類型 ('success' 或 'error')
 */
function showMessage(message, type = 'info') {
    const messageDiv = document.createElement('div');
    messageDiv.textContent = message;
    messageDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 5px;
        color: white;
        font-weight: bold;
        z-index: 10000;
        max-width: 300px;
        word-wrap: break-word;
        ${type === 'success' ? 'background-color: #4CAF50;' : 
          type === 'error' ? 'background-color: #f44336;' : 
          'background-color: #2196F3;'}
    `;
    
    document.body.appendChild(messageDiv);
    
    setTimeout(() => {
        if (messageDiv.parentNode) {
            messageDiv.parentNode.removeChild(messageDiv);
        }
    }, 3000);
}

/**
 * 提交表單資料
 */
async function submitFormData() {
    try {
        showMessage('正在提交資料...', 'info');
        
        const formData = collectFormData();
        
        if (!formData['客編'] && !formData['姓名']) {
            showMessage('請至少填入客編或姓名', 'error');
            return;
        }
        
        await sendDataToGoogleAppsScript(formData);
        
    } catch (error) {
        showMessage('提交失敗：' + error.message, 'error');
    }
}





