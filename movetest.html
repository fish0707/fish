<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>客戶資料查詢系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- 頂部導航 -->
    <nav class="bg-white shadow-lg border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold text-blue-600">客戶服務系統</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-600">客服專員：張小美</span>
                    <button class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700 transition-colors">登出</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主要內容 -->
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- 查詢區域 -->
        <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">客戶資料查詢</h2>
                <p class="text-gray-600">請輸入客戶資訊進行查詢</p>
            </div>

            <div class="max-w-2xl mx-auto">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">客戶編號</label>
                        <input type="text" id="customer-id" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" 
                               placeholder="例：C001234">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">客戶姓名</label>
                        <input type="text" id="customer-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" 
                               placeholder="例：王小明">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">聯絡電話</label>
                        <input type="text" id="customer-phone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" 
                               placeholder="例：02-2345-6789">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">身分證字號</label>
                        <input type="text" id="customer-id-number" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" 
                               placeholder="例：A123456789">
                    </div>
                </div>

                <div class="text-center">
                    <button onclick="searchCustomer()" class="bg-blue-600 text-white px-8 py-3 rounded-lg text-lg font-semibold hover:bg-blue-700 transform hover:scale-105 transition-all duration-200 shadow-lg">
                        <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        查詢客戶資料
                    </button>
                </div>
            </div>
        </div>

        <!-- 查詢結果區域 -->
        <div id="search-results" class="hidden">
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="bg-gradient-to-r from-blue-600 to-indigo-600 px-8 py-6">
                    <h3 class="text-2xl font-bold text-white">客戶資料</h3>
                </div>

                <div class="p-8">
                    <!-- 基本資料 -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <div class="bg-gray-50 rounded-lg p-6">
                            <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                                基本資料
                            </h4>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">客戶編號：</span>
                                    <span class="font-medium" id="result-customer-id">C001234</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">客戶姓名：</span>
                                    <span class="font-medium" id="result-customer-name">王小明</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">身分證字號：</span>
                                    <span class="font-medium" id="result-id-number">A123456789</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">聯絡電話：</span>
                                    <span class="font-medium" id="result-phone">02-2345-6789</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">手機號碼：</span>
                                    <span class="font-medium" id="result-mobile">0912-345-678</span>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-6">
                            <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                服務地址
                            </h4>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">地區：</span>
                                    <span class="font-medium" id="result-area">台北市信義區</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">社區名稱：</span>
                                    <span class="font-medium" id="result-community">信義花園</span>
                                </div>
                                <div class="col-span-2">
                                    <span class="text-gray-600">完整地址：</span>
                                    <div class="mt-1 font-medium" id="result-address">台北市信義區信義路五段7號12樓</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 移機申請區域 -->
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                            </svg>
                            移機申請
                        </h4>

                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">備註說明</label>
                            <textarea id="move-notes" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none" 
                                      placeholder="請詳細說明移機需求、新地址資訊或其他特殊要求..."></textarea>
                        </div>

                        <div class="text-center">
                            <button onclick="submitMoveRequest()" class="bg-orange-600 text-white px-8 py-3 rounded-lg text-lg font-semibold hover:bg-orange-700 transform hover:scale-105 transition-all duration-200 shadow-lg">
                                <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                                </svg>
                                提交移機申請
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 無查詢結果 -->
        <div id="no-results" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8 text-center">
                <div class="text-gray-400 mb-4">
                    <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.29-1.044-5.709-2.709M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-2">查無客戶資料</h3>
                <p class="text-gray-600 mb-4">請確認輸入的資訊是否正確，或聯絡系統管理員</p>
                <button onclick="clearSearch()" class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition-colors">
                    重新查詢
                </button>
            </div>
        </div>
    </div>

    <!-- 成功提交模態框 -->
    <div id="success-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
                <div class="p-6 text-center">
                    <div class="text-green-600 mb-4">
                        <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-900 mb-2">申請提交成功！</h3>
                    <p class="text-gray-600 mb-4">移機申請已成功提交，系統已為您建立客訴單號：<span id="generated-ticket-id" class="font-semibold text-blue-600"></span></p>
                    <p class="text-sm text-gray-500 mb-6">申請將轉入後台處理系統，相關人員會盡快與您聯絡</p>
                    
                    <div class="space-y-3">
                        <button onclick="goToBackend()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            進入後台處理系統
                        </button>
                        <button onclick="closeSuccessModal()" class="w-full bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition-colors">
                            關閉
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 後台處理系統 -->
    <div id="backend-system" class="hidden">
        <!-- 後台導航 -->
        <nav class="bg-gray-800 shadow-lg border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <h1 class="text-2xl font-bold text-white">後台處理系統</h1>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-300">處理專員：李大華</span>
                        <button onclick="goToFrontend()" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700 transition-colors">
                            返回客戶系統
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- 後台主要內容 -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- 標籤頁導航 -->
            <div class="bg-white rounded-lg shadow-lg mb-6">
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex space-x-8 px-6">
                        <button id="tab-pending" onclick="switchTab('pending')" class="py-4 px-1 border-b-2 border-blue-500 font-medium text-sm text-blue-600">
                            代處理 <span class="bg-red-100 text-red-800 text-xs font-medium px-2.5 py-0.5 rounded-full ml-2">2</span>
                        </button>
                        <button id="tab-processing" onclick="switchTab('processing')" class="py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                            處理中 <span class="bg-yellow-100 text-yellow-800 text-xs font-medium px-2.5 py-0.5 rounded-full ml-2">0</span>
                        </button>
                        <button id="tab-completed" onclick="switchTab('completed')" class="py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                            已完成 <span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full ml-2">0</span>
                        </button>
                    </nav>
                </div>

                <!-- 代處理內容 -->
                <div id="pending-content" class="p-6">
                    <div class="space-y-4">
                        <!-- 示例工單 1 -->
                        <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-4 mb-2">
                                        <span class="text-lg font-semibold text-gray-900">客訴單號: CS-2024-001</span>
                                        <span class="bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs font-medium">緊急</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 text-sm text-gray-600 mb-3">
                                        <div><span class="font-medium">客戶編號:</span> C001234</div>
                                        <div><span class="font-medium">社區名稱:</span> 信義花園</div>
                                        <div><span class="font-medium">地區:</span> 台北市信義區</div>
                                        <div><span class="font-medium">建立時間:</span> 2024-01-15 14:30</div>
                                    </div>
                                    <div class="text-sm text-gray-700 bg-gray-50 p-3 rounded">
                                        <strong>客訴內容:</strong> 需要辦理移機服務，搬遷至新地址，請安排相關作業。
                                    </div>
                                </div>
                                <button onclick="startProcessing('CS-2024-001')" class="ml-4 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 text-sm font-medium">
                                    開始處理
                                </button>
                            </div>
                        </div>

                        <!-- 示例工單 2 -->
                        <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-4 mb-2">
                                        <span class="text-lg font-semibold text-gray-900">客訴單號: CS-2024-002</span>
                                        <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs font-medium">一般</span>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 text-sm text-gray-600 mb-3">
                                        <div><span class="font-medium">客戶編號:</span> C001235</div>
                                        <div><span class="font-medium">社區名稱:</span> 大安御品</div>
                                        <div><span class="font-medium">地區:</span> 台北市大安區</div>
                                        <div><span class="font-medium">建立時間:</span> 2024-01-15 16:45</div>
                                    </div>
                                    <div class="text-sm text-gray-700 bg-gray-50 p-3 rounded">
                                        <strong>客訴內容:</strong> 需要辦理移機服務，搬遷至新地址，請安排相關作業。
                                    </div>
                                </div>
                                <button onclick="startProcessing('CS-2024-002')" class="ml-4 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 text-sm font-medium">
                                    開始處理
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 處理中內容 -->
                <div id="processing-content" class="p-6 hidden">
                    <div class="text-center py-12">
                        <div class="text-gray-400 mb-4">
                            <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">目前沒有處理中的工單</h3>
                        <p class="text-gray-500">處理中的工單會顯示在這裡</p>
                    </div>
                </div>

                <!-- 已完成內容 -->
                <div id="completed-content" class="p-6 hidden">
                    <div class="text-center py-12">
                        <div class="text-gray-400 mb-4">
                            <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">目前沒有已完成的工單</h3>
                        <p class="text-gray-500">已完成的工單會顯示在這裡</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 工單建立模態框 -->
        <div id="work-order-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-screen overflow-y-auto">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-semibold text-gray-900">建立工單</h3>
                            <button onclick="closeWorkOrderModal()" class="text-gray-400 hover:text-gray-600">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>

                        <!-- 客戶資訊顯示 -->
                        <div class="bg-gray-50 rounded-lg p-4 mb-6">
                            <h4 class="font-semibold text-gray-900 mb-3">客戶資訊</h4>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div><span class="font-medium">客訴單號:</span> <span id="modal-ticket-id">-</span></div>
                                <div><span class="font-medium">客戶編號:</span> <span id="modal-customer-id">-</span></div>
                                <div><span class="font-medium">客戶姓名:</span> <span id="modal-customer-name">-</span></div>
                                <div><span class="font-medium">地區:</span> <span id="modal-area">-</span></div>
                                <div><span class="font-medium">社區:</span> <span id="modal-community">-</span></div>
                                <div><span class="font-medium">電話:</span> <span id="modal-phone">-</span></div>
                                <div><span class="font-medium">手機:</span> <span id="modal-mobile">-</span></div>
                                <div class="col-span-2"><span class="font-medium">地址:</span> <span id="modal-address">-</span></div>
                                <div class="col-span-2"><span class="font-medium">客訴內容:</span> <span id="modal-complaint-content">-</span></div>
                            </div>
                        </div>

                        <!-- 工單表單 -->
                        <form class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">新地址 *</label>
                                    <input type="text" id="new-address" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">新社區 *</label>
                                    <input type="text" id="new-community" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">預約安裝日期 *</label>
                                    <input type="date" id="install-date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">聯絡時間</label>
                                    <select id="contact-time" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="上午">上午 (09:00-12:00)</option>
                                        <option value="下午">下午 (13:00-17:00)</option>
                                        <option value="晚上">晚上 (18:00-21:00)</option>
                                        <option value="全天">全天 (09:00-21:00)</option>
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">備註</label>
                                <textarea id="work-order-notes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="其他特殊需求或注意事項..."></textarea>
                            </div>

                            <div class="flex justify-end space-x-3 pt-4">
                                <button type="button" onclick="closeWorkOrderModal()" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                                    取消
                                </button>
                                <button type="button" onclick="submitWorkOrder()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                    建立工單
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 模擬客戶資料庫
        const customerDatabase = {
            'C001234': {
                customerId: 'C001234',
                customerName: '王小明',
                idNumber: 'A123456789',
                phone: '02-2345-6789',
                mobile: '0912-345-678',
                area: '台北市信義區',
                community: '信義花園',
                address: '台北市信義區信義路五段7號12樓',
                services: ['網路服務', '有線電視', '固網電話']
            },
            'C001235': {
                customerId: 'C001235',
                customerName: '李小華',
                idNumber: 'B987654321',
                phone: '02-2876-5432',
                mobile: '0923-456-789',
                area: '台北市大安區',
                community: '大安御品',
                address: '台北市大安區復興南路一段390號8樓',
                services: ['網路服務', '有線電視', 'MOD服務']
            },
            'C001236': {
                customerId: 'C001236',
                customerName: '張美玲',
                idNumber: 'C456789123',
                phone: '02-2234-5678',
                mobile: '0934-567-890',
                area: '台北市松山區',
                community: '松山新城',
                address: '台北市松山區民生東路四段133號5樓',
                services: ['網路服務', '固網電話']
            }
        };

        // 查詢客戶資料
        function searchCustomer() {
            const customerId = document.getElementById('customer-id').value.trim();
            const customerName = document.getElementById('customer-name').value.trim();
            const customerPhone = document.getElementById('customer-phone').value.trim();
            const customerIdNumber = document.getElementById('customer-id-number').value.trim();

            console.log('開始查詢，輸入的資料：', {
                customerId: customerId,
                customerName: customerName,
                customerPhone: customerPhone,
                customerIdNumber: customerIdNumber
            });

            // 檢查是否至少輸入一個查詢條件
            if (!customerId && !customerName && !customerPhone && !customerIdNumber) {
                alert('請至少輸入一個查詢條件');
                return;
            }

            // 模擬查詢過程
            showLoading();

            setTimeout(() => {
                let foundCustomer = null;

                console.log('資料庫內容：', customerDatabase);

                // 根據不同條件查詢
                for (let id in customerDatabase) {
                    const customer = customerDatabase[id];
                    console.log('檢查客戶：', customer);
                    
                    // 客戶編號查詢（完全匹配）
                    if (customerId && customer.customerId === customerId) {
                        console.log('找到匹配的客戶編號：', customer);
                        foundCustomer = customer;
                        break;
                    }
                    
                    // 客戶姓名查詢（部分匹配）
                    if (customerName && customer.customerName.includes(customerName)) {
                        console.log('找到匹配的客戶姓名：', customer);
                        foundCustomer = customer;
                        break;
                    }
                    
                    // 電話查詢（部分匹配）
                    if (customerPhone && customer.phone.includes(customerPhone)) {
                        console.log('找到匹配的電話：', customer);
                        foundCustomer = customer;
                        break;
                    }
                    
                    // 身分證字號查詢（完全匹配）
                    if (customerIdNumber && customer.idNumber === customerIdNumber) {
                        console.log('找到匹配的身分證字號：', customer);
                        foundCustomer = customer;
                        break;
                    }
                }

                console.log('查詢結果：', foundCustomer);

                hideLoading();

                if (foundCustomer) {
                    displayCustomerData(foundCustomer);
                } else {
                    showNoResults();
                }
            }, 1000);
        }

        // 顯示載入狀態
        function showLoading() {
            const button = document.querySelector('button[onclick="searchCustomer()"]');
            button.innerHTML = `
                <svg class="animate-spin w-5 h-5 inline-block mr-2" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                查詢中...
            `;
            button.disabled = true;
        }

        // 隱藏載入狀態
        function hideLoading() {
            const button = document.querySelector('button[onclick="searchCustomer()"]');
            button.innerHTML = `
                <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                查詢客戶資料
            `;
            button.disabled = false;
        }

        // 顯示客戶資料
        function displayCustomerData(customer) {
            // 填入客戶資料
            document.getElementById('result-customer-id').textContent = customer.customerId;
            document.getElementById('result-customer-name').textContent = customer.customerName;
            document.getElementById('result-id-number').textContent = customer.idNumber;
            document.getElementById('result-phone').textContent = customer.phone;
            document.getElementById('result-mobile').textContent = customer.mobile;
            document.getElementById('result-area').textContent = customer.area;
            document.getElementById('result-community').textContent = customer.community;
            document.getElementById('result-address').textContent = customer.address;

            // 儲存當前客戶資料到全域變數
            window.currentCustomer = customer;

            // 顯示結果區域
            document.getElementById('search-results').classList.remove('hidden');
            document.getElementById('no-results').classList.add('hidden');

            // 滾動到結果區域
            document.getElementById('search-results').scrollIntoView({ behavior: 'smooth' });
        }

        // 顯示無結果
        function showNoResults() {
            document.getElementById('search-results').classList.add('hidden');
            document.getElementById('no-results').classList.remove('hidden');
            document.getElementById('no-results').scrollIntoView({ behavior: 'smooth' });
        }

        // 清除搜尋
        function clearSearch() {
            document.getElementById('customer-id').value = '';
            document.getElementById('customer-name').value = '';
            document.getElementById('customer-phone').value = '';
            document.getElementById('customer-id-number').value = '';
            document.getElementById('search-results').classList.add('hidden');
            document.getElementById('no-results').classList.add('hidden');
        }

        // 提交移機申請
        function submitMoveRequest() {
            const moveNotes = document.getElementById('move-notes').value.trim();

            // 驗證必填欄位
            if (!moveNotes) {
                alert('請填寫備註說明');
                return;
            }

            // 生成客訴單號
            const ticketId = 'CS-' + new Date().getFullYear() + '-' + String(Date.now()).slice(-6);

            // 儲存申請資料到 localStorage（模擬傳送到後台）
            const applicationData = {
                ticketId: ticketId,
                customer: window.currentCustomer,
                notes: moveNotes,
                submitTime: new Date().toISOString(),
                status: 'pending'
            };

            localStorage.setItem('moveApplication_' + ticketId, JSON.stringify(applicationData));

            // 顯示成功模態框
            document.getElementById('generated-ticket-id').textContent = ticketId;
            document.getElementById('success-modal').classList.remove('hidden');
        }

        // 關閉成功模態框
        function closeSuccessModal() {
            document.getElementById('success-modal').classList.add('hidden');
            
            // 清除表單
            document.getElementById('move-notes').value = '';
            clearSearch();
        }

        // 進入後台處理系統
        function goToBackend() {
            // 將新申請資料儲存到 localStorage 供後台系統讀取
            const ticketId = document.getElementById('generated-ticket-id').textContent;
            const applicationData = JSON.parse(localStorage.getItem('moveApplication_' + ticketId));
            
            if (applicationData) {
                // 將資料加入到待處理列表
                let pendingApplications = JSON.parse(localStorage.getItem('pendingApplications') || '[]');
                pendingApplications.push(applicationData);
                localStorage.setItem('pendingApplications', JSON.stringify(pendingApplications));
                
                // 觸發後台系統更新事件
                localStorage.setItem('newApplicationAdded', Date.now().toString());
            }
            
            // 切換到後台系統
            document.querySelector('body > div:first-child').classList.add('hidden'); // 隱藏前台
            document.getElementById('backend-system').classList.remove('hidden'); // 顯示後台
            
            // 載入後台資料
            loadBackendData();
            
            closeSuccessModal();
        }

        // 返回前台系統
        function goToFrontend() {
            document.getElementById('backend-system').classList.add('hidden'); // 隱藏後台
            document.querySelector('body > div:first-child').classList.remove('hidden'); // 顯示前台
        }

        // 載入後台資料
        function loadBackendData() {
            const pendingApplications = JSON.parse(localStorage.getItem('pendingApplications') || '[]');
            const pendingContent = document.getElementById('pending-content');
            const spaceDiv = pendingContent.querySelector('.space-y-4');
            
            // 清空現有的新申請（保留示例工單）
            const existingTickets = spaceDiv.querySelectorAll('[data-new-application]');
            existingTickets.forEach(ticket => ticket.remove());
            
            // 加入新申請
            pendingApplications.forEach(app => {
                const priority = Math.random() > 0.5 ? '緊急' : '一般';
                const priorityClass = priority === '緊急' ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800';
                
                const ticketHtml = `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow" data-new-application="true">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center space-x-4 mb-2">
                                    <span class="text-lg font-semibold text-gray-900">客訴單號: ${app.ticketId}</span>
                                    <span class="${priorityClass} px-2 py-1 rounded-full text-xs font-medium">${priority}</span>
                                </div>
                                <div class="grid grid-cols-2 gap-4 text-sm text-gray-600 mb-3">
                                    <div><span class="font-medium">客戶編號:</span> ${app.customer.customerId}</div>
                                    <div><span class="font-medium">社區名稱:</span> ${app.customer.community}</div>
                                    <div><span class="font-medium">地區:</span> ${app.customer.area}</div>
                                    <div><span class="font-medium">建立時間:</span> ${new Date(app.submitTime).toLocaleString('zh-TW')}</div>
                                </div>
                                <div class="text-sm text-gray-700 bg-gray-50 p-3 rounded">
                                    <strong>客訴內容:</strong> ${app.notes}
                                </div>
                            </div>
                            <button onclick="startProcessing('${app.ticketId}')" class="ml-4 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 text-sm font-medium">
                                開始處理
                            </button>
                        </div>
                    </div>
                `;
                
                spaceDiv.insertAdjacentHTML('afterbegin', ticketHtml);
            });
            
            // 更新待處理數量
            updateTabCount('pending', pendingApplications.length);
        }

        // 切換標籤頁
        function switchTab(tabName) {
            // 隱藏所有內容
            document.getElementById('pending-content').classList.add('hidden');
            document.getElementById('processing-content').classList.add('hidden');
            document.getElementById('completed-content').classList.add('hidden');
            
            // 移除所有標籤的活動狀態
            document.getElementById('tab-pending').className = 'py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300';
            document.getElementById('tab-processing').className = 'py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300';
            document.getElementById('tab-completed').className = 'py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300';
            
            // 顯示選中的內容和標籤
            document.getElementById(tabName + '-content').classList.remove('hidden');
            document.getElementById('tab-' + tabName).className = 'py-4 px-1 border-b-2 border-blue-500 font-medium text-sm text-blue-600';
        }

        // 更新標籤數量
        function updateTabCount(tabName, additionalCount = 0) {
            const tab = document.getElementById('tab-' + tabName);
            const span = tab.querySelector('span');
            const currentCount = parseInt(span.textContent);
            span.textContent = currentCount + additionalCount;
        }

        // 開始處理工單
        function startProcessing(ticketId) {
            // 檢查是否為新申請的工單
            let data = null;
            const pendingApplications = JSON.parse(localStorage.getItem('pendingApplications') || '[]');
            const newApp = pendingApplications.find(app => app.ticketId === ticketId);
            
            if (newApp) {
                data = {
                    customerId: newApp.customer.customerId,
                    customerName: newApp.customer.customerName,
                    area: newApp.customer.area,
                    community: newApp.customer.community,
                    phone: newApp.customer.phone,
                    mobile: newApp.customer.mobile,
                    address: newApp.customer.address,
                    complaint: newApp.notes
                };
            } else {
                // 如果不是新申請，使用示例資料
                const customerData = {
                    'CS-2024-001': {
                        customerId: 'C001234',
                        customerName: '王小明',
                        area: '台北市信義區',
                        community: '信義花園',
                        phone: '02-2345-6789',
                        mobile: '0912-345-678',
                        address: '台北市信義區信義路五段7號',
                        complaint: '需要辦理移機服務，搬遷至新地址，請安排相關作業。'
                    },
                    'CS-2024-002': {
                        customerId: 'C001235',
                        customerName: '李小華',
                        area: '台北市大安區',
                        community: '大安御品',
                        phone: '02-2876-5432',
                        mobile: '0923-456-789',
                        address: '台北市大安區復興南路一段390號',
                        complaint: '需要辦理移機服務，搬遷至新地址，請安排相關作業。'
                    }
                };
                data = customerData[ticketId];
            }

            if (data) {
                document.getElementById('modal-ticket-id').textContent = ticketId;
                document.getElementById('modal-customer-id').textContent = data.customerId;
                document.getElementById('modal-customer-name').textContent = data.customerName;
                document.getElementById('modal-area').textContent = data.area;
                document.getElementById('modal-community').textContent = data.community;
                document.getElementById('modal-phone').textContent = data.phone;
                document.getElementById('modal-mobile').textContent = data.mobile;
                document.getElementById('modal-address').textContent = data.address;
                document.getElementById('modal-complaint-content').textContent = data.complaint;
            }

            // 直接開啟工單建立視窗
            document.getElementById('work-order-modal').classList.remove('hidden');
            
            // 設定預設安裝日期為明天
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('install-date').value = tomorrow.toISOString().split('T')[0];
            
            // 儲存當前處理的工單ID
            window.currentProcessingTicketId = ticketId;
        }

        // 關閉工單建立模態框
        function closeWorkOrderModal() {
            document.getElementById('work-order-modal').classList.add('hidden');
            
            // 清空表單
            document.getElementById('new-address').value = '';
            document.getElementById('new-community').value = '';
            document.getElementById('install-date').value = '';
            document.getElementById('contact-time').value = '上午';
            document.getElementById('work-order-notes').value = '';
        }

        // 提交工單
        function submitWorkOrder() {
            const newAddress = document.getElementById('new-address').value;
            const newCommunity = document.getElementById('new-community').value;
            const installDate = document.getElementById('install-date').value;
            const contactTime = document.getElementById('contact-time').value;
            const notes = document.getElementById('work-order-notes').value;
            
            if (!newAddress || !newCommunity || !installDate) {
                alert('請填寫所有必填欄位');
                return;
            }
            
            // 生成工單號碼
            const workOrderNumber = 'WO-' + new Date().getTime();
            
            // 關閉工單建立視窗
            closeWorkOrderModal();
            
            // 儲存工單資訊
            const workOrder = {
                number: workOrderNumber,
                address: newAddress,
                community: newCommunity,
                installDate: installDate,
                contactTime: contactTime,
                notes: notes,
                status: 'processing',
                ticketId: window.currentProcessingTicketId,
                customerName: document.getElementById('modal-customer-name').textContent,
                customerId: document.getElementById('modal-customer-id').textContent
            };
            
            // 將工單加入處理中列表
            addToProcessingList(workOrder);
            
            // 從待處理中移除該工單
            removeFromPendingList(window.currentProcessingTicketId);
            
            alert(`工單建立成功！\n工單編號：${workOrderNumber}\n新地址：${newAddress}\n新社區：${newCommunity}\n\n工單已移至「處理中」狀態，等待其他單位安裝完成。`);
            
            // 自動切換到處理中頁籤
            switchTab('processing');
            
            // 模擬其他單位處理工單
            simulateExternalProcessing(workOrderNumber);
        }

        // 將工單加入處理中列表
        function addToProcessingList(workOrder) {
            const processingContent = document.getElementById('processing-content');
            
            // 如果是空狀態，先清空
            if (processingContent.querySelector('.text-center')) {
                processingContent.innerHTML = '<div class="space-y-4"></div>';
            }
            
            const spaceDiv = processingContent.querySelector('.space-y-4') || processingContent;
            
            const workOrderHtml = `
                <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow" data-work-order="${workOrder.number}">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center space-x-4 mb-2">
                                <span class="text-lg font-semibold text-gray-900">工單編號: ${workOrder.number}</span>
                                <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs font-medium">處理中</span>
                            </div>
                            <div class="grid grid-cols-2 gap-4 text-sm text-gray-600 mb-3">
                                <div><span class="font-medium">客戶編號:</span> ${workOrder.customerId}</div>
                                <div><span class="font-medium">客戶姓名:</span> ${workOrder.customerName}</div>
                                <div><span class="font-medium">新地址:</span> ${workOrder.address}</div>
                                <div><span class="font-medium">新社區:</span> ${workOrder.community}</div>
                                <div><span class="font-medium">安裝日期:</span> ${workOrder.installDate}</div>
                                <div><span class="font-medium">聯絡時間:</span> ${workOrder.contactTime}</div>
                            </div>
                            <div class="text-sm text-gray-700">
                                <strong>處理項目:</strong> 移機服務安裝
                            </div>
                            ${workOrder.notes ? `<div class="text-sm text-gray-600 mt-2 bg-gray-50 p-2 rounded"><strong>備註:</strong> ${workOrder.notes}</div>` : ''}
                        </div>
                        <div class="ml-4 text-sm text-gray-500">
                            等待其他單位處理...
                        </div>
                    </div>
                </div>
            `;
            
            spaceDiv.insertAdjacentHTML('beforeend', workOrderHtml);
            
            // 更新處理中數量
            updateTabCount('processing', 1);
        }

        // 從待處理列表移除工單
        function removeFromPendingList(ticketId) {
            // 從 localStorage 移除
            let pendingApplications = JSON.parse(localStorage.getItem('pendingApplications') || '[]');
            pendingApplications = pendingApplications.filter(app => app.ticketId !== ticketId);
            localStorage.setItem('pendingApplications', JSON.stringify(pendingApplications));
            
            // 從 DOM 移除
            const pendingContent = document.getElementById('pending-content');
            const ticketElements = pendingContent.querySelectorAll('[data-new-application]');
            ticketElements.forEach(element => {
                if (element.textContent.includes(ticketId)) {
                    element.remove();
                }
            });
            
            // 更新待處理數量
            const tab = document.getElementById('tab-pending');
            const span = tab.querySelector('span');
            const currentCount = parseInt(span.textContent);
            if (currentCount > 0) {
                span.textContent = currentCount - 1;
            }
        }

        // 模擬其他單位處理工單
        function simulateExternalProcessing(workOrderNumber) {
            setTimeout(() => {
                // 將工單從處理中移至已完成
                const processingElement = document.querySelector(`[data-work-order="${workOrderNumber}"]`);
                if (processingElement) {
                    // 移除處理中的工單
                    processingElement.remove();
                    
                    // 更新處理中數量
                    const processingTab = document.getElementById('tab-processing');
                    const processingSpan = processingTab.querySelector('span');
                    const processingCount = parseInt(processingSpan.textContent);
                    if (processingCount > 0) {
                        processingSpan.textContent = processingCount - 1;
                    }
                    
                    // 加入已完成列表
                    addToCompletedList(workOrderNumber);
                    
                    alert(`工單 ${workOrderNumber} 已完成安裝！\n\n移機服務已完成，客戶可正常使用服務。`);
                }
            }, 10000); // 10秒後完成
        }

        // 將工單加入已完成列表
        function addToCompletedList(workOrderNumber) {
            const completedContent = document.getElementById('completed-content');
            
            // 如果是空狀態，先清空
            if (completedContent.querySelector('.text-center')) {
                completedContent.innerHTML = '<div class="space-y-4"></div>';
            }
            
            const spaceDiv = completedContent.querySelector('.space-y-4') || completedContent;
            
            const completedHtml = `
                <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center space-x-4 mb-2">
                                <span class="text-lg font-semibold text-gray-900">工單編號: ${workOrderNumber}</span>
                                <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium">已完成</span>
                            </div>
                            <div class="text-sm text-gray-700 mb-3">
                                <strong>處理項目:</strong> 移機服務安裝 - 已完成安裝
                            </div>
                            <div class="text-sm text-gray-600">
                                <strong>完成時間:</strong> ${new Date().toLocaleString('zh-TW')}
                            </div>
                        </div>
                        <div class="ml-4 text-sm text-green-600 font-medium">
                            ✓ 安裝完成
                        </div>
                    </div>
                </div>
            `;
            
            spaceDiv.insertAdjacentHTML('beforeend', completedHtml);
            
            // 更新已完成數量
            updateTabCount('completed', 1);
        }

        // 頁面載入時的初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 可以在這裡加入初始化邏輯
            console.log('客戶查詢系統已載入');
        });

        // Enter 鍵搜尋功能
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const activeElement = document.activeElement;
                if (activeElement.id === 'customer-id' || 
                    activeElement.id === 'customer-name' || 
                    activeElement.id === 'customer-phone' || 
                    activeElement.id === 'customer-id-number') {
                    searchCustomer();
                }
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96a2d83f5619f251',t:'MTc1NDM2MDczNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>






